# Swagger Website Dev Docs

Hey There Mr. Marshall / Anyone else looking to help out!

Here's a basic overview of the file structure/how it works. In each file, I'll have comments explaining what everything does. 

## Running the application

> **Dependencies**
> 
> You will need [NodeJS](https://nodejs.org/en). I recommend using [Node Version Manager](https://github.com/nvm-sh/nvm). 


To run the development application from the command line, run `npm run dev`. Remember run `npm install` before you try to run it! 

If it doesn't work due to a Tina error like "Unexpected end of JSON input" or something, try again a couple times. If it still doesn't work, delete the `/tina/__generated__` directory and try again. If it *still* doesn't run, you have a real problem. This is a slight quirk with Tina. 

## Next.JS & Tina

This is a basic [Tina](https://tina.io/) template that works with [Next.JS](https://nextjs.org/). NextJS is a [React](https://react.dev/) framework, which means it is totally based off React. As such, all the react functions/structure are there. It is a react application under the hood. 

### What does it mean to be a react application?

Each page is a big javascript function that gets called by react. In each page, there are functions for every HTML component. You can use default html components (like `<div>` or `<p>`), or you can use custom components, which are really custom functions. I recommend reading the docs for both [React](https://react.dev/learn/thinking-in-react) and [NextJS](https://nextjs.org/docs). **Keep in mind I am using the Pages Router for NextJS, so look for solutions/documentation using that (as opposed to the app router).**

### But what about Tina?

Tina is a content managment system that runs in the app. It differs from other CMSs because it 1. Runs within the app, 2. Has live/intuitive editing (live editing is disabled right now which I will explain later) and 3. Is super easy to grab data from (no apis!! kinda...). However, it's relatively new and is open source, so it might be a little buggy/not well maintained. However, I havn't had many issues. 

Here's what happens with Tina. Basically, Tina wraps the NextJS app into it's own application. It runs Tina first, then runs the Next app as a subprocess. When you edit things in the Admin page, Tina edits little markdown files (found in the `/content` directory.) Then, my code grabs those markdown files and uses the content in them. 

Because the files change, every time you change something in Tina, it will push the new content to git. This leads to some interesting mechanics. It's just good to know about. 

As for the Tina configuration, all of the config/files are stored in the `/tina` directory. Here's how that works. 

#### Tina Directory

Tina works with things called Collections. Each Collection is a Javascript object that describes what content you want to be editable. I like to think of a collection as a template for each content editing page. For example, the `page` collection (found at `/tina/collections/page.js`) describes all of the content that I want editable in my pages. I have it set so the editor can add/delete new pages, so the editor can add any page they want, and the CMS panel will show what I put in `page.js`. When the editor does add a page, it creates a new markdown file in `/content/page/`, which I can reference in my actual nextjs file. 

The `page` collection describes settings for each page, but if I wanted to describe general settings for the whole site, I could make a new collection (such as `general.js`). In this one, I'll set it so the editor can not add/delete new pages, so they're not creating multiple general settings files. And to make it so it changes the whole site, I'll just reference it in every nextjs file!

[Here's the docs on collection fields.](https://Tina.io/docs/reference/fields/)

All of the actual tina config is found in `/tina/config.js`. Here's where you're actually supposed to define collections, but I just create files for them and then import them in. There's not much you have to do in here (except add your collection files when you create new ones!), but I'll comment the code so you can see what does what. 

### Grabbing content

You can grab content in each nextjs page file with the `getServerSideProps()` function. This is a little complicated and I'm not sure I fully understand how it works, so if you're having trouble with it, [here's the link to the docs on it.](https://nextjs.org/docs/pages/building-your-application/data-fetching/get-server-side-props). 

What I do know is that it can pass variables into the actual page function, which you can then use. I use this to get data from the google sheets (the calendar data), and the Tina data. 

To actually get the Tina data, you call a **[GraphQL](https://graphql.org/) function**. You can either call a default GraphQL function, like `client.queries.page`, which are autogenerated by Tina for each collection, or your own. For the default functions, you need to define which markdown file you want to reference.

However, you can also make your own GraphQL functions to grab data from multiple collections. These can be found in `/tina/queries/`. I use this to grab both the general settings and the specific page for each page. [Here's the Tina docs on custom queries](https://tina.io/docs/data-fetching/custom-queries/). 

There's a GraphQL playground built into Tina that you can use to play around with what you can grab from each markdown file. It's found at `localhost:3000/admin/index.html#/graphql` when you run the app. 

## Site Setup

I've set up the site in a way that allows for expansion. In the `/pages` directory, there are a few files. Here's what each does. 

> `_app.js`
> 
> This is the wrapper function for the whole entire site. You don't need to do much with this. Not really sure what it does. [Docs Reference](https://nextjs.org/docs/pages/building-your-application/routing/custom-app)

> `[slug].js`
> 
> This is the default page. It's kind of cool. It will load a page for any slug that comes after `https://swaggertina.vercel.app/`. For example, when the site gets a request to `https://swaggertina.vercel.app/thisisatest`, it will run the `[slug].js` page with the slug prop `thisisatest`. You can then access the slug in the page and use it to customize the page. It's basically a way to have an infinite amount of pages. 

> `index.js`
>
> This is the Home page. It's the exact same as the `[slug].js` page, except when the site gets a request to just `https://swaggertina.vercel.app/`, it routes to index.js instead of `[slug].js`

> `globals.css`
>
> This is the css file for the whole site. 

> `CELTG.ttf` &  `Celtica-Bold.ttf`
>
> These are font files. I have to store them in pages for them to work for some reason. Not sure why. 

> `/event`
>
> This is a directory for the singular event pages. It has a `[slug].js` page inside, so any event can be loaded. It'll route to `https://swaggertina.vercel.app/event/[slug]`

> `/api`
>
> This is an API endpoint. I use it for the email system. More on that later. 

Additionally, there are some things in the `/components` folder. I import these into the pages and use them. They're little functions that I can pass props into. It's kind of like making my own html tags. I'll leave comments on each one telling you what they do, but here are the two important ones. 

> `Layout.js`
>
> This wraps the whole site. It includes the `<head>` tag and the title and other things. If you look at `index.js` or `[slug].js`, you'll see the first component that wraps everything is `<Layout>`. That's this. 

> `email-helper.ts`
>
> This is for the email system. Again, more on that later. 

## Email System

The email system is a little complicated and I mostly followed a tutorial for it (which I've since lost). Here's my basic understanding. When you have the `contact.js` component in your page, and someone enters the information, it posts to `/api/submit.js`. Then, that uses the `email-helper.ts` component to send an email using nodemailer. 

## Bugs/Needed things

1. I need to set up everything on the swagger email so you can work with vercel. You need to be able to work with vercel. 
2. We need to switch the email that contacts send to to rick or the swagger email instead of mine. 
3. I need to comment the code because it's extremely hard to follow (I have trouble a lot of the time, and I wrote it!)
4. I need to talk about the block system in this readme and do examples. 
